import{ap as $,aq as D,ai as I,a as i,ah as t,ar as M,aw as U}from"./index-DlZb9DCW.js";import{D as C,X as b,Z as B,B as L,Q as F,M as _,O as P,W as R}from"./IdurarOs-D9w05FI2.js";import"./index-IkVWE-2m.js";import{d as k,s as v,E as S}from"./selectors-CkaJXagg.js";import{e as h}from"./actions-BsPDIvc3.js";import{d as O,P as Y}from"./index-Babd-3t9.js";import{s as N}from"./index-KrFx5yLV.js";import{u as W}from"./useDate-DuhxoyiA.js";import{c as g}from"./calculate-D_c7Goec.js";import{P as q,F as H}from"./PaymentForm-DLZzJaeV.js";import{t as w}from"./statusTagColor-DxbKI3gy.js";import{T as A}from"./index-fGz7MDv9.js";import{D as l}from"./index-Do9tPE5J.js";import{C as Q}from"./CloseCircleOutlined-Dv7tP5lo.js";import"./ErpApp-CtPnJ3L1.js";import"./index-DJ_CV9yw.js";import"./index-Bnnboqmj.js";import"./useFetch-BmELsX3j.js";import"./color-CnuJOIlI.js";import"./index-Bbuw7Hxd.js";function X({config:n,currentInvoice:s}){const a=C(),o=$();let{entity:m}=n;const r=D(),{isLoading:u,isSuccess:e}=I(k),[p]=b.useForm(),[j,T]=i.useState(0);i.useEffect(()=>{if(s){const{credit:c,total:x,discount:y,amount:E}=s;T(g.sub(g.sub(x,y),g.sub(g.sub(c,E))));const d={...s};d.date&&(d.date=O(d.date)),p.setFieldsValue(d)}},[s]),i.useEffect(()=>{e&&(p.resetFields(),r(h.resetAction({actionType:"recordPayment"})),r(h.list({entity:m})),o(`/${m.toLowerCase()}/read/${s._id}`))},[e]);const f=c=>{if(s){const{_id:x}=s,y=s.client&&s.client._id;c={...c,invoice:x,client:y}}r(h.update({entity:m,id:s._id,jsonData:c}))};return t.jsx(t.Fragment,{children:t.jsx(B,{isLoading:u,children:t.jsxs(b,{form:p,layout:"vertical",onFinish:f,children:[t.jsx(q,{maxAmount:j}),t.jsx(b.Item,{children:t.jsx(L,{type:"primary",htmlType:"submit",children:a("Update")})})]})})})}function Z({config:n,currentItem:s}){var f,c;const a=C(),{entity:o,ENTITY_NAME:m}=n,r=W(),u=$(),[e,p]=i.useState(s);i.useEffect(()=>{const x=new AbortController;if(s){const{invoice:y,_id:E,...d}=s;p({...d,...y,_id:E})}return()=>x.abort()},[s]);const[j,T]=i.useState({});return i.useEffect(()=>{e!=null&&e.client&&T(e.client[e.client.type])},[e]),t.jsxs(t.Fragment,{children:[t.jsx(F,{gutter:[12,12],children:t.jsxs(_,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[t.jsx(Y,{onBack:()=>u(`/${o.toLowerCase()}`),title:`Update  ${m} # ${e.number}/${e.year||""}`,ghost:!1,tags:t.jsx(A,{color:(f=w(e.paymentStatus))==null?void 0:f.color,children:e.paymentStatus}),extra:[t.jsx(L,{onClick:()=>{u(`/${o.toLowerCase()}`)},icon:t.jsx(Q,{}),children:a("Cancel")},`${N.generate()}`),t.jsx(L,{onClick:()=>u(`/invoice/read/${e._id}`),icon:t.jsx(H,{}),children:a("Show invoice")},`${N.generate()}`)],style:{padding:"20px 0px"}}),t.jsx(P,{dashed:!0})]})}),t.jsxs(F,{gutter:[12,12],children:[t.jsxs(_,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[t.jsx("div",{className:"space50"}),t.jsxs(l,{title:`Customer : ${e.client.name}`,column:1,children:[t.jsx(l.Item,{label:a("email"),children:j.email}),t.jsx(l.Item,{label:a("Phone"),children:j.phone}),t.jsx(P,{dashed:!0}),t.jsx(l.Item,{label:a("Payment Status"),children:t.jsx(A,{color:(c=w(e.paymentStatus))==null?void 0:c.color,children:e.paymentStatus})}),t.jsx(l.Item,{label:a("SubTotal"),children:r.moneyFormatter({amount:e.subTotal,currency_code:e.currency})}),t.jsx(l.Item,{label:a("Total"),children:r.moneyFormatter({amount:e.total,currency_code:e.currency})}),t.jsx(l.Item,{label:"Discount",children:r.moneyFormatter({amount:e.discount,currency_code:e.currency})}),t.jsx(l.Item,{label:"Balance",children:r.moneyFormatter({amount:e.credit,currency_code:e.currency})})]})]}),t.jsx(_,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:t.jsx(X,{config:n,currentInvoice:e})})]})]})}function z({config:n}){const s=D(),{id:a}=M();i.useLayoutEffect(()=>{s(h.read({entity:n.entity,id:a}))},[a]);const{result:o,isSuccess:m,isLoading:r=!0}=I(v);return i.useLayoutEffect(()=>{o&&s(h.currentAction({actionType:"update",id:a,data:o}))},[o]),r?t.jsx(S,{children:t.jsx(U,{})}):t.jsx(S,{children:m?t.jsx(Z,{config:n,currentItem:o}):t.jsx(R,{entity:n.entity})})}function ht(){const n=C(),s="payment",a={PANEL_TITLE:n("payment"),DATATABLE_TITLE:n("payment_list"),ADD_NEW_ENTITY:n("add_new_payment"),ENTITY_NAME:n("payment")},o={entity:s,...a};return t.jsx(z,{config:o})}export{ht as default};
